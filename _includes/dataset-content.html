{% assign page = include.dataset %}

{% if page %}
<div class="dataset-page">
  <header class="dataset-header">
    <div class="container">
      <div class="dataset-logo-container">
        <img src="{{ site.baseurl }}/assets/images/{{ page.id | default: 'default' }}-logo.svg" alt="{{ page.name | default: 'Dataset' }} Logo" class="dataset-logo dataset-logo-svg" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
        <div class="dataset-logo dataset-logo-fallback" style="display: none;">{{ page.logo.text | default: page.name | slice: 0 }}</div>
      </div>
      <h1>{{ page.name | default: "Dataset" }}</h1>
      <p>{{ page.description | default: "No description available" }}</p>
      <div class="dataset-meta">
        <div class="meta-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
          Released: {{ page.release_date | default: "N/A" | date: "%B %d, %Y" }}
        </div>
        <div class="meta-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
          </svg>
          Status: <span class="status-badge {{ page.status | default: 'unknown' }}">{{ page.status | default: "Unknown" | capitalize }}</span>
        </div>
        <div class="meta-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path>
            <polyline points="13 2 13 9 20 9"></polyline>
          </svg>
          Size: {{ page.dataset_details.size | default: "Unknown" }}
        </div>
      </div>
    </div>
  </header>

  <div class="dataset-subnav">
    <div class="container">
      <div class="subnav-container">
        <a href="#stats" class="subnav-link">Overview</a>
        <a href="#features" class="subnav-link">Features</a>
        <a href="#usage" class="subnav-link">Usage</a>
        <a href="#technical-details" class="subnav-link">Technical Details</a>
        <a href="#get-started" class="subnav-link">Get Started</a>
      </div>
    </div>
  </div>

  <section id="stats" class="stats-section">
    <div class="container">
      <h2>Dataset Overview</h2>
      {% if page.stats and page.stats.size > 0 %}
      <div class="stats">
        {% for stat in page.stats %}
          <div class="stat-card">
            <div class="stat-number">{{ stat.value | default: "N/A" }}</div>
            <p>{{ stat.label | default: "Statistic" }}</p>
          </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="no-data-message">
        <p>No statistics are currently available for this dataset.</p>
      </div>
      {% endif %}
    </div>
  </section>

  <section id="features" class="features">
    <div class="container">
      <h2>Features</h2>
      {% if page.features and page.features.size > 0 %}
      <div class="feature-grid">
        {% for feature in page.features %}
          <div class="feature-card">
            <h3><span class="feature-icon">{{ feature.icon | default: "âœ“" }}</span> {{ feature.title | default: "Feature" }}</h3>
            <p>{{ feature.description | default: "No description available" }}</p>
          </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="no-data-message">
        <p>Features information is not available for this dataset.</p>
      </div>
      {% endif %}
    </div>
  </section>

  {% if page.status == 'published' %}
  <section id="usage" class="code-section">
    <div class="container">
      <h2>Usage Example</h2>
      <div class="code-block">
        <button class="copy-button" onclick="copyCode()">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
          </svg>
          Copy
        </button>
        <pre><code class="language-python">from datasets import load_dataset

# Load {{ page.name | default: "Dataset" }}
dataset = load_dataset("{{ page.publishing[0].repository | default: 'repository_name' }}")

# Basic usage
for item in dataset['train']:
    print(f"Title: {item['title']}")
    
# Available fields
print(f"Available fields: {dataset['train'].features}")

# Dataset statistics
print(f"Total samples: {len(dataset['train'])}")</code></pre>
      </div>
    </div>
  </section>
  {% endif %}
  
  <section id="metadata" class="metadata-section">
    <div class="container">
      <h2>Dataset Access</h2>
      <div class="metadata-grid">
        <div class="metadata-card">
          <h3>Sources</h3>
          <ul class="metadata-list">
            {% for source in page.sources %}
              <li>
                <strong>{{ source.platform | capitalize }}</strong>: 
                {% if source.url %}
                  <a href="{{ source.url }}" target="_blank">{{ source.dataset }}</a>
                {% else %}
                  {{ source.dataset }}
                {% endif %}
              </li>
            {% endfor %}
          </ul>
        </div>
        
        <div class="metadata-card">
          <h3>Releases</h3>
          <ul class="metadata-list">
            <li><strong>Initial Release</strong>: {{ page.release_date | date: "%B %d, %Y" }}</li>
            <li><strong>Update Frequency</strong>: {{ page.expected_update }}</li>
            <li><strong>Status</strong>: <span class="status-badge {{ page.status }}">{{ page.status }}</span></li>
          </ul>
        </div>
      </div>
    </div>
  </section>
  
  {% if page.dataset_details %}
  <section id="technical-details" class="technical-section">
    <div class="container">
      <h2>Technical Specifications</h2>
      
      <div class="tech-details-grid">
        <div class="tech-card">
          <h3>Dataset Overview</h3>
          <ul class="tech-list">
            <li><strong>Size</strong>: {{ page.dataset_details.size }}</li>
            <li><strong>Format</strong>: {{ page.dataset_details.file_format }}</li>
            {% for split in page.dataset_details.splits %}
            <li><strong>{{ split.name | capitalize }}</strong>: {{ split.records }} records</li>
            {% endfor %}
          </ul>
        </div>
        
        <div class="tech-card">
          <h3>Statistics</h3>
          <ul class="tech-list">
            {% for stat_pair in page.dataset_details.statistics %}
              {% if stat_pair[1].first %}
                <li>
                  <strong>{{ stat_pair[0] | replace: '_', ' ' | capitalize }}</strong>:
                  <ul class="nested-list">
                    {% for item in stat_pair[1] %}
                      {% if item.first %}
                        <li>{{ item.first }}: {{ item.last }}</li>
                      {% else %}
                        <li>{{ item }}</li>
                      {% endif %}
                    {% endfor %}
                  </ul>
                </li>
              {% else %}
                <li><strong>{{ stat_pair[0] | replace: '_', ' ' | capitalize }}</strong>: {{ stat_pair[1] }}</li>
              {% endif %}
            {% endfor %}
          </ul>
        </div>
      </div>
      
      <div class="schema-section">
        <h3>Schema</h3>
        <div class="schema-table-wrapper">
          <table class="schema-table">
            <thead>
              <tr>
                <th>Field</th>
                <th>Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              {% for field in page.dataset_details.schema %}
              <tr>
                <td><code>{{ field.name }}</code></td>
                <td><code>{{ field.type }}</code></td>
                <td>{{ field.description }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      
      <div class="preprocessing-section">
        <h3>Preprocessing</h3>
        <ul class="preprocessing-list">
          {% for step in page.dataset_details.preprocessing %}
          <li>{{ step }}</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </section>
  {% endif %}

  <section id="get-started" class="cta-section">
    <div class="container">
      <h2>Ready to Get Started?</h2>
      <p>Access the dataset through your preferred platform</p>
      <div class="cta-buttons">
        {% for pub in page.publishing %}
          <a href="{{ pub.url }}" class="button {% if forloop.first %}primary{% else %}secondary{% endif %}" target="_blank">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="button-icon">
              {% if pub.platform == 'huggingface' %}
                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
              {% elsif pub.platform == 'github' %}
                <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
              {% else %}
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                <polyline points="15 3 21 3 21 9"></polyline>
                <line x1="10" y1="14" x2="21" y2="3"></line>
              {% endif %}
            </svg>
            View on {{ pub.platform | capitalize }}
          </a>
        {% endfor %}
      </div>
    </div>
  </section>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Handle navigation scrolling
    const navLinks = document.querySelectorAll('.subnav-link');
    navLinks.forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        const targetId = this.getAttribute('href');
        const targetElement = document.querySelector(targetId);
        if (targetElement) {
          window.scrollTo({
            top: targetElement.offsetTop - 100,
            behavior: 'smooth'
          });
        }
      });
    });

    // Copy code function
    window.copyCode = function() {
      const codeBlock = document.querySelector('.code-block pre code');
      if (codeBlock) {
        const textToCopy = codeBlock.textContent;
        navigator.clipboard.writeText(textToCopy).then(
          function() {
            const copyButton = document.querySelector('.copy-button');
            const originalText = copyButton.innerHTML;
            copyButton.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg> Copied!';
            setTimeout(() => {
              copyButton.innerHTML = originalText;
            }, 2000);
          },
          function(err) {
            console.error('Could not copy text: ', err);
            alert('Failed to copy code. Please try again or copy manually.');
          }
        );
      }
    };
  });
  
  // Error handling for images
  document.querySelectorAll('img').forEach(img => {
    img.addEventListener('error', function() {
      if (!this.src.includes('default')) {
        this.src = '{{ site.baseurl }}/assets/images/default-logo.svg';
      }
    });
  });
</script>
{% else %}
<div class="error-boundary">
  <div class="error-message">
    <h2>Dataset Configuration Error</h2>
    <p>The dataset configuration is missing or invalid.</p>
    <a href="{{ site.baseurl }}/" class="button primary">Return to Home</a>
  </div>
</div>
{% endif %} 